## Generando Test automatizados

- Existe una variedad de test automatizados que podemos generar.
- vamas a usar la validacion horariodefuncionamientoclinica
- Usando Junit y Mockito

Prompt: "ayudame a crear pruebas de test automatizadas con JUnit y mockito de la siguiente validacion: @Component
public class HorarioDeFuncionamientoClinica implements ValidadorDeConsultas{
    public void validar(DatosAgendarConsulta datos) {

        var domingo = DayOfWeek.SUNDAY.equals(datos.fecha().getDayOfWeek());

        var antesdDeApertura=datos.fecha().getHour()<7;
        var despuesDeCierre=datos.fecha().getHour()>19;
        if(domingo || antesdDeApertura || despuesDeCierre){
            throw  new ValidationException("El horario de atención de la clínica es de lunes a sábado, de 07:00 a 19:00 horas");
        }
    }
}"

Respuesta con chatgpt 4o:

```markdown
Para crear pruebas automatizadas con JUnit y Mockito para la clase `HorarioDeFuncionamientoClinica`, puedes seguir estos pasos. Las pruebas se enfocarán en validar que el método `validar` funciona correctamente, lanzando una excepción cuando los datos de la consulta no cumplen con las reglas de horario.

### Paso 1: Configurar el Proyecto
Asegúrate de tener las dependencias de JUnit y Mockito en tu archivo `pom.xml` (si usas Maven):

```xml
<dependencies>
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.8.1</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-core</artifactId>
        <version>4.0.0</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-junit-jupiter</artifactId>
        <version>4.0.0</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

### Paso 2: Crear la Clase de Pruebas

```java
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

import java.time.DayOfWeek;
import java.time.LocalDateTime;

import javax.validation.ValidationException;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.InjectMocks;
import org.mockito.MockitoAnnotations;

public class HorarioDeFuncionamientoClinicaTest {

    @InjectMocks
    private HorarioDeFuncionamientoClinica validador;

    @BeforeEach
    public void setup() {
        MockitoAnnotations.openMocks(this);
    }

    @Test
    public void deberiaLanzarExcepcionSiEsDomingo() {
        // Arrange
        var datos = mock(DatosAgendarConsulta.class);
        when(datos.fecha()).thenReturn(LocalDateTime.of(2024, 8, 25, 10, 0)); // Domingo

        // Act & Assert
        assertThrows(ValidationException.class, () -> validador.validar(datos), 
            "El horario de atención de la clínica es de lunes a sábado, de 07:00 a 19:00 horas");
    }

    @Test
    public void deberiaLanzarExcepcionSiEsAntesDeApertura() {
        // Arrange
        var datos = mock(DatosAgendarConsulta.class);
        when(datos.fecha()).thenReturn(LocalDateTime.of(2024, 8, 23, 6, 0)); // Viernes antes de las 07:00

        // Act & Assert
        assertThrows(ValidationException.class, () -> validador.validar(datos), 
            "El horario de atención de la clínica es de lunes a sábado, de 07:00 a 19:00 horas");
    }

    @Test
    public void deberiaLanzarExcepcionSiEsDespuesDeCierre() {
        // Arrange
        var datos = mock(DatosAgendarConsulta.class);
        when(datos.fecha()).thenReturn(LocalDateTime.of(2024, 8, 23, 20, 0)); // Viernes después de las 19:00

        // Act & Assert
        assertThrows(ValidationException.class, () -> validador.validar(datos), 
            "El horario de atención de la clínica es de lunes a sábado, de 07:00 a 19:00 horas");
    }

    @Test
    public void noDeberiaLanzarExcepcionSiEsHorarioValido() {
        // Arrange
        var datos = mock(DatosAgendarConsulta.class);
        when(datos.fecha()).thenReturn(LocalDateTime.of(2024, 8, 23, 10, 0)); // Viernes dentro del horario

        // Act & Assert
        validador.validar(datos);
    }
}
```

### Explicación de la Clase de Pruebas

1. **`@InjectMocks`**: Inyecta el mock en el objeto `HorarioDeFuncionamientoClinica`, que es la clase que estamos probando.
  
2. **`@BeforeEach`**: Inicializa los mocks antes de cada prueba usando `MockitoAnnotations.openMocks(this)`.

3. **`assertThrows`**: Verifica que una `ValidationException` sea lanzada cuando se viola una regla de validación (cuando es domingo, antes de las 7:00, o después de las 19:00).

4. **`mock(DatosAgendarConsulta.class)`**: Crea un mock de la clase `DatosAgendarConsulta`, que es pasada al método `validar`.

5. **Pruebas individuales**:
   - **`deberiaLanzarExcepcionSiEsDomingo`**: Prueba que la validación falle si la fecha es un domingo.
   - **`deberiaLanzarExcepcionSiEsAntesDeApertura`**: Prueba que la validación falle si la hora es antes de las 07:00.
   - **`deberiaLanzarExcepcionSiEsDespuesDeCierre`**: Prueba que la validación falle si la hora es después de las 19:00.
   - **`noDeberiaLanzarExcepcionSiEsHorarioValido`**: Prueba que la validación pase si la fecha y hora son válidas.

Estas pruebas te ayudarán a asegurar que la lógica en `HorarioDeFuncionamientoClinica` funciona correctamente bajo diferentes condiciones.
```

## Pasos:

1. se agregan las dependencias:

```xml
<dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.8.1</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-core</artifactId>
        <version>4.0.0</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>org.mockito</groupId>
        <artifactId>mockito-junit-jupiter</artifactId>
        <version>4.0.0</version>
        <scope>test</scope>
    </dependency>
```


En el intellij se puede solicitar que se genere el test.

![alt generar_test](/imagenes/clase04/generar_test.png)

![alt configura_junit](/imagenes/clase04/configura_jnuit.png)